// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Property {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  title        String
  description  String
  price        Float
  area         Float
  address      String
  ward         String?
  district     String?
  city         String?
  propertyType String
  purpose      String
  status       String
  bedrooms     Int?
  bathrooms    Int?
  floors       Int?
  legal        String?
  direction    String?
  images       String[]
  highlights   String[]
  postedAt     DateTime @default(now())
  userId       String?                // lưu firebaseUid
  projectSlug  String?
  specs        Json?

  @@index([userId])
  @@index([postedAt])
  @@index([purpose])
  @@index([propertyType])
  @@index([city, district])           // hay dùng để filter theo khu vực
  @@index([price])
  @@index([area])
}

model Project {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  slug        String   @unique
  description String
  imageUrl    String?
  createdAt   DateTime @default(now())
}

model User {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  firebaseUid  String   @unique
  email        String?  @unique   // ⚠️ chỉ set khi có; không set null để tránh trùng unique
  name         String?
  photoUrl     String?
  phone        String?
  role         String   @default("user")
  createdAt    DateTime @default(now())
  lastLoginAt  DateTime?
}

model SavedSearch {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String
  name      String?
  filters   Json
  sort      String?
  createdAt DateTime @default(now())

  @@index([userId])
}
